"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2364],{7703:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"ecosystem-vite","title":"Vite","description":"Vite is a tool for both local development and the building of applications. It was created within the Vue ecosystem, but can be used with other UI frameworks, too.","source":"@site/versioned_docs/version-5.x/ecosystem-vite.md","sourceDirName":".","slug":"/ecosystem-vite","permalink":"/docs/5.x/ecosystem-vite","draft":false,"unlisted":false,"editUrl":"https://github.com/single-spa/single-spa.js.org/blob/master/website/versioned_docs/version-5.x/ecosystem-vite.md","tags":[],"version":"5.x","frontMatter":{"id":"ecosystem-vite","title":"Vite","sidebar_label":"Vite"},"sidebar":"docs","previous":{"title":"AlpineJS","permalink":"/docs/5.x/ecosystem-alpinejs"},"next":{"title":"Snowpack","permalink":"/docs/5.x/ecosystem-snowpack"}}');var n=s(4848),o=s(8453);const r={id:"ecosystem-vite",title:"Vite",sidebar_label:"Vite"},a=void 0,l={},c=[{value:"Example repo",id:"example-repo",level:2},{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Local development",id:"local-development",level:2},{value:"Native Modules vs SystemJS",id:"native-modules-vs-systemjs",level:2},{value:"vite-plugin-single-spa",id:"vite-plugin-single-spa",level:2},{value:"Main Features",id:"main-features",level:3}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://github.com/vitejs/vite",children:"Vite"})," is a tool for both local development and the building of applications. It was created within the Vue ecosystem, but can be used with other UI frameworks, too."]}),"\n",(0,n.jsx)(t.h2,{id:"example-repo",children:"Example repo"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://github.com/joeldenning/vite-single-spa-example",children:"https://github.com/joeldenning/vite-single-spa-example"})}),"\n",(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(t.p,{children:["By default, Vite uses ES modules in local development, but not in production. This works well with single-spa, which encourages using ",(0,n.jsx)(t.a,{href:"/docs/recommended-setup#in-browser-versus-build-time-modules",children:"in-browser modules"})," as the interface for each microfrontend. To use vite with single-spa, you must export the ",(0,n.jsx)(t.a,{href:"/docs/building-applications#registered-application-lifecycle",children:"single-spa lifecycle functions"})," from your Vite's ",(0,n.jsx)(t.code,{children:"main.js"})," file and then make a few modifications to the ",(0,n.jsx)(t.code,{children:"vite.config.js"})," file."]}),"\n",(0,n.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsxs)(t.p,{children:["Modify the ",(0,n.jsx)(t.code,{children:"src/main.js"})," file to not mount your app immediately, but rather to export the single-spa lifecycles. For Vue apps, see ",(0,n.jsx)(t.a,{href:"https://single-spa.js.org/docs/ecosystem-vue#usage",children:"https://single-spa.js.org/docs/ecosystem-vue#usage"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"The following Vite config can be used as the basis for a single-spa + Vite setup:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'import vue from "@vitejs/plugin-vue";\n\nexport default {\n  rollupOptions: {\n    input: "src/main.js",\n    format: "system",\n    preserveEntrySignatures: true,\n  },\n  base: "http://localhost:3000",\n  plugins: [\n    vue({\n      template: {\n        transformAssetUrls: {\n          base: "/src",\n        },\n      },\n    }),\n  ],\n};\n'})}),"\n",(0,n.jsx)(t.h2,{id:"local-development",children:"Local development"}),"\n",(0,n.jsxs)(t.p,{children:["Vite works well with ",(0,n.jsx)(t.a,{href:"https://single-spa.js.org/docs/recommended-setup#local-development",children:"development via import map overrides"}),". You should use ",(0,n.jsx)(t.a,{href:"http://localhost:3000/src/main.js",children:"http://localhost:3000/src/main.js"})," as the URL for your import map override. It is important to note, however, that assets such as images and fonts won't load. The import map is only used to load JavaScript, not media files. The import map does not affect asset URL's. Asset URL's are affected by Vite's ",(0,n.jsx)(t.code,{children:"base"})," configuration property, and Vite doesn't respect full URL's in said property while in serve mode (",(0,n.jsx)(t.code,{children:"npm run dev"}),"). While in serve mode, a base with a full URL is stripped down to its path. Therefore, the asset URL's don't really get the correct host URL. The author of ",(0,n.jsx)(t.a,{href:"https://www.npmjs.com/package/vite-plugin-single-spa",children:"vite-plugin-single-spa"})," has opened ",(0,n.jsx)(t.a,{href:"https://github.com/vitejs/vite/discussions/13927",children:"a discussion in Vite's GitHub"})," that you can opt to support by upvoting it."]}),"\n",(0,n.jsx)(t.h2,{id:"native-modules-vs-systemjs",children:"Native Modules vs SystemJS"}),"\n",(0,n.jsx)(t.p,{children:"single-spa works well with native modules, systemjs, or even both. With Vite + single-spa, a general recommendation is to use native modules during local development, but SystemJS in production (since browser support for Import Maps is still pending). Doing this is nice because it matches Vite's development workflow; however, mixing native and systemjs modules also can have some caveats:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The browser and SystemJS maintain separate module registries. This means that you can't share imports between SystemJS and native modules. So if you are doing an import map override for a Vite application on a page that also uses SystemJS, you may end up with multiple instances of Vue (and other shared libraries), which is different than how things will work in production. This is generally okay, except for situations where the Vue instance is modified via ",(0,n.jsx)(t.code,{children:"Vue.use()"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://github.com/systemjs/systemjs/pull/2187",children:"This PR to SystemJS"})," shows how you can populate native modules into the SystemJS registry, allowing for one-way sharing of modules between the two registries. The PR was closed due to some edge cases, but it generally works. Even though the PR is closed, you can paste the ESM extra into your root config and it will work. If you have interest in driving forward better SystemJS + ESM compatibility, comment on Github or Slack with your interest."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"vite-plugin-single-spa",children:"vite-plugin-single-spa"}),"\n",(0,n.jsxs)(t.p,{children:["This is a new entry that is currently in the early stages of development, but shows significant progress (",(0,n.jsx)(t.a,{href:"https://github.com/WJSoftware/vite-plugin-single-spa",children:"view in GitHub"}),"). It claims to be able to convert out-of-the-box Vite projects (regardless of the framework) into single-spa micro-frontend projects and even root config projects. While the single-spa team discourages the use of UI frameworks in root configs, it is indeed an alternative that may interest people."]}),"\n",(0,n.jsxs)(t.p,{children:["To convert a Vite project to a root config project, all that is needed is install ",(0,n.jsx)(t.code,{children:"vite-plugin-single-spa"}),", and then use it in ",(0,n.jsx)(t.code,{children:"vite.config.ts"}),". This is a Vite + Vue example:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"import vitePluginSingleSpa from 'vite-plugin-single-spa';\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [vue(), vitePluginSingleSpa({\n    type: 'root'\n    }\n  })]\n});\n"})}),"\n",(0,n.jsx)(t.p,{children:"To convert a Vite project to a micro-frontend project, a similarly minimalistic configuration is needed, plus a file that exports the single-spa lifecycle functions."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'// vite.config.ts for a Vite + React project\n\nimport react from "@vitejs/plugin-react";\nimport vitePluginSingleSpa from "vite-plugin-single-spa";\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [\n    react(),\n    vitePluginSingleSpa({\n      serverPort: 4101,\n      spaEntryPoint: "src/spa.tsx",\n    }),\n  ],\n});\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"// src/spa.tsx\n\nimport React from 'react';\nimport ReactDOMClient from 'react-dom/client';\n// @ts-ignore\nimport singleSpaReact from 'single-spa-react';\nimport App from './App';\nimport { cssLifecycle } from 'vite-plugin-single-spa/ex';\n\nconst lc = singleSpaReact({\n    React,\n    ReactDOMClient,\n    rootComponent: App,\n    errorBoundary(err: any, _info: any, _props: any) {\n        return <div>Error: {err}</div>\n    }\n});\n\nexport const bootstrap = [cssLifecycle.bootstrap, lc.bootstrap];\nexport const mount = [cssLifecycle.mount, lc.mount];\nexport const unmount = [cssLifecycle.unmount, lc.unmount];\n"})}),"\n",(0,n.jsx)(t.h3,{id:"main-features",children:"Main Features"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Supports stock Vite projects, regardless of framework."}),"\n",(0,n.jsx)(t.li,{children:"Micro-frontend projects behave dually while in serve mode: The micro-frontend can be previewed as a standalone web application with its server URL, or it can be served as a single-spa micro-frontend."}),"\n",(0,n.jsxs)(t.li,{children:["As seen in the example above, it provides an extra module that automatically mounts and unmounts the CSS referenced by the lifecycle-exporting module (",(0,n.jsx)(t.code,{children:"src/spa.tsx"})," in the example). ",(0,n.jsx)(t.strong,{children:"COMING SOON"})]}),"\n",(0,n.jsxs)(t.li,{children:["Automatically picks up import maps from ",(0,n.jsx)(t.code,{children:"src/importMap.dev.json"})," and ",(0,n.jsx)(t.code,{children:"src/importMap.json"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Automatically adds the ",(0,n.jsx)(t.code,{children:"import-map-overrides"})," NPM package, user interface included."]}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"IMPORTANT"}),": The author of this plug-in does not believe in creating dedicated root config projects. Furthermore, this package will, by default, create import maps for native modules. We at single-spa recommend SystemJS modules. Yes, single-spa is perfectly capable of working with native modules as well."]}),"\n",(0,n.jsx)(t.p,{children:"The opinions of the author of this plug-in in no way represent those of single-spa, and it is an independent work. We present it here as one more option in the Vite ecosystem."})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>a});var i=s(6540);const n={},o=i.createContext(n);function r(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);